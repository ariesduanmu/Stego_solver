from PIL import Image
from math import sqrt
from pyzbar.pyzbar import decode

def transe_to_qr(strings, qr_filename, show_qr = True):
    width = int(sqrt(len(message)))

    if width * width != len(message):
        raise Exception("this is not a square")
    qr_image = Image.new("RGB",(width, width))

    for y in range (width):
        for x in range (width):
            color = (0,0,0) if strings[width * y + x] == '1' else (255,255,255)
            qr_image.putpixel([x,y],color)

    if show_qr: qr_image.show()
    qr_image.save(qr_filename)
    return scan_qr(qr_filename)

def scan_qr(qr_filename):
    return decode(Image.open(qr_filename))

if __name__ == "__main__":
    message = "1111111111111100111111001100110000001111111111111111111111111111001111110011001100000011111111111111110000000000110011111100000000001100110000000000111100000000001100111111000000000011001100000000001111001111110011001100111100110011000011001111110011110011111100110011001111001100110000110011111100111100111111001100111100110000110000001100111111001111001111110011001111001100001100000011001111110011110011111100110000000000001111111100110011111100111100111111001100000000000011111111001100111111001111000000000011001100001111111100000011000000000011110000000000110011000011111111000000110000000000111111111111111100110011001100110011001111111111111111111111111111001100110011001100110011111111111111000000000000000000110000110011110000000000000000000000000000000000001100001100111100000000000000000011110000111111000000001100111100000000110011111111111100001111110000000011001111000000001100111111110000000011000011111111001100001111000000110000001100000000110000111111110011000011110000001100000011000000001100110011000011111111111100111111110000000000000011001100110000111111111111001111111100000011111111000000110000111100110011001111000000111100111111110000001100001111001100110011110000001111001111110000001111000011001111000011111100001111111111111100000011110000110011110000111111000011111111110000001100000011110000001111110011000011001111111100000011000000111100000011111100110000110011111100000000000011001111110000000011000000110000000000000000000000110011111100000000110000001100000000000000001100000000110000001100110011110000000011110000000011000000001100000011001100111100000000111100111111111100111111110011001111001111111111110000001111111111001111111100110011110011111111111100000000000000000000001100000011000011110000001100000011000000000000000011000000110000111100000011000000111111111111111100001100111111110011001100110011000011111111111111000011001111111100110011001100110000110000000000110011000011001100111100000011001100001100000000001100110000110011001111000000110011000011001111110011001111110011110000111111111111000011110011111100110011111100111100001111111111110000111100111111001100000011000011110000111111000000111111001111110011000000110000111100001111110000001111110011111100110000001100000000001100000000110011001100111111001100000011000000000011000000001100110011000000000011001100000011001111000011111100111100110000000000110011000000110011110000111111001111001111111111111100110011110011111100110000001100111111111111111111001100111100111111001100000011001111"
    print(transe_to_qr(message, "flag.png"))



# message in Hidden in Colors
# 1234567123456712345671234567123456712345671234567
# 011101000111001001101111011011000110110001100101011001000001010
# 1100100000101011001000001010110010000010101100100
# 1011110001011001010011111100000011101110110101110
# 94     22     41     124    7      59     46
